# üîß PATCH 0.4.3-B ‚Äî –ú–∏–Ω–∏-–≤–∏–¥–∂–µ—Ç—ã: API-–∫–ª—é—á + Rate-limit

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### **1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:**
- **`migrations/031_api_keys_and_limits.sql`** - —Ç–∞–±–ª–∏—Ü–∞ `tenant_api_keys` + –ª–∏–º–∏—Ç—ã –Ω–∞ –ø–ª–∞–Ω–∞—Ö

### **2. API –¥–ª—è –∫–ª—é—á–µ–π:**
- **`src/app/api/admin/keys/route.ts`** - GET (masked) / POST (—Ä–æ—Ç–∞—Ü–∏—è, plaintext –æ–¥–∏–Ω —Ä–∞–∑)

### **3. API –¥–ª—è –ª–∏–º–∏—Ç–æ–≤:**
- **`src/app/api/admin/limits/summary/route.ts`** - —Ç–µ–∫—É—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞

### **4. –ê–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–π:**
- **`src/app/admin/keys/page.tsx`** - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π 4, —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å

### **5. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–∏–º–∏—Ç–∞ –≤ usage:**
- **`src/app/admin/usage/page.tsx`** - –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ª–∏–º–∏—Ç–∞ –∑–∞ –º–µ—Å—è—Ü

### **6. –ù–∞–≤–∏–≥–∞—Ü–∏—è:**
- **`src/app/admin/page.tsx`** - —Å—Å—ã–ª–∫–∞ –Ω–∞ API –∫–ª—é—á

## üß™ –ë–´–°–¢–†–´–ô SMOKE (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏):

```bash
# –º–∏–≥—Ä–∞—Ü–∏—è
# (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ drizzle-kit ‚Äî –ø—Ä–æ–≥–æ–Ω–∏—Ç–µ, –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ Neon)
# –∑–∞—Ç–µ–º –±–∏–ª–¥/—Å—Ç–∞—Ä—Ç:
npm run build
npm start

# –∞–¥–º–∏–Ω
# /admin/keys ‚Üí –ü–æ–ª—É—á–∏—Ç—å (GET), –∑–∞—Ç–µ–º "–†–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á" (POST) ‚Üí –ø–æ—è–≤–∏—Ç—Å—è PLAINTEXT (–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ä–∞–∑—É)
# /admin/usage ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∞ –ª–∏–º–∏—Ç–∞ + –≥—Ä–∞—Ñ–∏–∫

# curl-–ø—Ä–æ–≤–µ—Ä–∫–∏
curl -s -u admin:****** https://getlifeundo.com/api/admin/keys | jq
curl -s -u admin:****** https://getlifeundo.com/api/admin/limits/summary | jq
```

## üìã ENV –ù–ê–°–¢–†–û–ô–ö–ò:

```env
# .env (–æ–±–∞ –¥–æ–º–µ–Ω–∞ / Beget)
DEFAULT_MONTH_LIMIT=100000
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

- –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ SHA-256**
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º plaintext **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏
- –î–∞–ª—å—à–µ ‚Äî —Ç–æ–ª—å–∫–æ –º–∞—Å–∫–∞ `‚Ä¢‚Ä¢‚Ä¢‚Ä¢1234`
- –î–æ—Å—Ç—É–ø –∫ `/api/admin/*` –∑–∞—â–∏—â—ë–Ω BasicAuth + whitelist

## üéØ –ì–û–¢–û–í–û:

**–ú–∏–Ω–∏-–≤–∏–¥–∂–µ—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:**
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–∏–º–∏—Ç–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π (—Ç–æ–ª—å–∫–æ —Ö—ç—à)
- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –ø–æ–∫–∞–∑ plaintext –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

---

**–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "Revoke" (–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ–∑ —Ä–æ—Ç–∞—Ü–∏–∏) –∏ —ç–∫—Å–ø–æ—Ä—Ç CSV usage? –°–∫–∞–∂–∏: ¬´revoke + csv ‚Äî –æ–¥–Ω–∏–º –ø–æ—Å—Ç–æ–º¬ª üöÄ**


