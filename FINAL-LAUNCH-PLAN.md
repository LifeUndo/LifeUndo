# üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∑–∞–ø—É—Å–∫–∞ (—É–ª—å—Ç—Ä–∞-–∫–æ—Ä–æ—Ç–∫–æ)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (5 –º–∏–Ω—É—Ç)

### 1. üîê –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- [ ] **FK –∫–∞–±–∏–Ω–µ—Ç:** –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `SECRET1`, `SECRET2`, `API_KEY`
- [ ] **Vercel ENV:** –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- [ ] **Redeploy Production**

### 2. üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Notify URL
- [ ] **–ö–∞–±–∏–Ω–µ—Ç FK:** Notify = `https://<project>.vercel.app/api/fk/notify`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:** –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å **200**

### 3. üß™ –ü—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤
- [ ] **Smoke Test:** `.\smoke-test-freekassa.ps1 https://<project>.vercel.app`
- [ ] **–≠–º—É–ª—è—Ç–æ—Ä Notify:** `.\fk-notify-sim.ps1 https://<project>.vercel.app MERCHANT_ID 2490.00 LU-test-123 SECRET2`
- [ ] **–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã:** `./negative-tests.sh https://<project>.vercel.app MERCHANT_ID SECRET2`

### 4. üì± iPhone –ø–ª–∞—Ç—ë–∂
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/pricing` –Ω–∞ iPhone
- [ ] –í–≤–µ—Å—Ç–∏ email ‚Üí "–ö—É–ø–∏—Ç—å VIP"
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ FreeKassa ‚Üí —Ç–µ—Å—Ç–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/success.html`
- [ ] **–í –ª–æ–≥–∞—Ö:** –û–¥–∏–Ω `[FK][notify] OK`, CID —Å–æ–≤–ø–∞–¥–∞–µ—Ç

---

## üìä –ü–æ—Å–ª–µ 1-2 —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–ª–∞—Ç

### üîÑ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- [ ] **–ï—â—ë –æ–¥–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è** —Å–µ–∫—Ä–µ—Ç–æ–≤ (–∏—Ç–æ–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤)
- [ ] **Redeploy Production**
- [ ] **–û–±–Ω–æ–≤–∏—Ç—å ENV —Å–Ω–∞–ø—à–æ—Ç**

### üìã –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç—á—ë—Ç–∞
- [ ] **–°–∫—Ä–∏–Ω ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å=200¬ª** (–≤ –∫–∞–±–∏–Ω–µ—Ç–µ FK)
- [ ] **–§—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤:**
  ```
  [FK][create] { order_id: "LU-...", email: "ab***@domain.com", correlation_id: "cid-..." }
  [FK][notify] OK { order_id: "LU-...", correlation_id: "cid-..." }
  ```
- [ ] **–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–π–Ω—Ç–∞:**
  ```bash
  GET /api/admin/orders?order_id=LU-<—Ä–µ–∞–ª—å–Ω—ã–π-id>
  ```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] **TTL —É `order:<id>`:** 30 –¥–Ω–µ–π
- [ ] **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π notify:** –° —Ç–µ–º –∂–µ `order_id` –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

---

## üëÄ –ù–∞–±–ª—é–¥–µ–Ω–∏–µ (–ø–µ—Ä–≤—ã–µ 48 —á–∞—Å–æ–≤)

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- [ ] **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ create/notify** –≤ —á–∞—Å
- [ ] **Median –≤—Ä–µ–º—è** –º–µ–∂–¥—É create –∏ notify
- [ ] **–î–æ–ª—è –æ—à–∏–±–æ–∫:** "Bad signature/amount"

### üö® –ê–ª–µ—Ä—Ç—ã
- [ ] **< 5 —É—Å–ø–µ—à–Ω—ã—Ö/—á–∞—Å** ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- [ ] **> 3 –æ—à–∏–±–æ–∫/10–º–∏–Ω** ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### üõ°Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] **Rate-limit:** –ù–µ—Ç –ª–∏ "—à—Ç–æ—Ä–º–∞" –ø–æ IP/–±–æ—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞
- [ ] **Honeypot:** –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤
- [ ] **Correlation ID:** –í—Å–µ –ª–∏ —Ü–µ–ø–æ—á–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –•–∞—Ä–¥–Ω–∏–Ω–≥ –Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

### üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (—Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–ª–∏–∑)
- [ ] **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ priceMap** –≤ –∫–æ–Ω—Ñ–∏–≥ (RU/EN –≤–∞–ª—é—Ç—ã/–ª–æ–∫–∞–ª–∏)
- [ ] **Retry-–æ—á–µ—Ä–µ–¥—å** –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –ª–∏—Ü–µ–Ω–∑–∏–π (—á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö SMTP)
- [ ] **–õ–æ–≥–∏ —Å CID** —Å—Ç—Ä–∏–º–∏—Ç—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/Logtail) –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤—ã

### üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–±—É–¥—É—â–∏–µ —Ä–µ–ª–∏–∑—ã)
- [ ] **Webhook retry** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- [ ] **–ú–µ—Ç—Ä–∏–∫–∏** –≤ Prometheus/Grafana
- [ ] **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º –ø–æ–¥–ø–∏—Å–∏

---

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ "—â—ë–ª–∫–Ω–µ—Ç"

### –ù–∞ iPhone
**–ü—Ä–∏—Å–ª–∞—Ç—å:**
- –¢–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ Network/Console
- –°—Ç—Ä–æ–∫—É –∏–∑ –ª–æ–≥–æ–≤ —Å `cid`
- –°–∫—Ä–∏–Ω –æ—à–∏–±–∫–∏

**–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å—ã:**
- **405 –Ω–∞ notify:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Vercel-–¥–æ–º–µ–Ω
- **Bad signature:** –°–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É –ø–æ–¥–ø–∏—Å–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ FK
- **CORS –æ—à–∏–±–∫–∏:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ALLOWED_ORIGIN`

### –í –ª–æ–≥–∞—Ö
**–ò—Å–∫–∞—Ç—å:**
- `[FK][create]` - —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `[FK][notify] OK` - —É—Å–ø–µ—à–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `Rate limit exceeded` - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- `Honeypot triggered` - –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### ‚úÖ –ó–∞–ø—É—Å–∫ —É—Å–ø–µ—à–µ–Ω
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- iPhone –ø–ª–∞—Ç—ë–∂ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –õ–æ–≥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ < 500ms
- Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω

---

## üöÄ –ì–æ—Ç–æ–≤ –∫ –±–æ—é!

**–í—Å–µ —Å–∏—Å—Ç–µ–º—ã –≥–æ—Ç–æ–≤—ã:**
- ‚úÖ –ë–æ–µ–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∞
- ‚úÖ –ê–Ω—Ç–∏-—Å–ø–∞–º –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Correlation ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Rollback-–ø–ª–∞–Ω –≥–æ—Ç–æ–≤

**üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–≤—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏!

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–∏

- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** developer@lifeundo.ru
- **FreeKassa –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** —á–µ—Ä–µ–∑ –∫–∞–±–∏–Ω–µ—Ç FK
- **Vercel –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** —á–µ—Ä–µ–∑ dashboard
