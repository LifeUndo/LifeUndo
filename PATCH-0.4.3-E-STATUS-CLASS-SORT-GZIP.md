# üîß PATCH 0.4.3-E ‚Äî **CSV: —Å—Ç–∞—Ç—É—Å-–∫–ª–∞—Å—Å (2xx/3xx/4xx/5xx) + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ + gzip**

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### **üìä CSV-—ç–∫—Å–ø–æ—Ä—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**
- **`src/app/api/admin/usage/export/route.ts`** - –¥–æ–±–∞–≤–ª–µ–Ω—ã statusClass, sortBy, sortDir, gzip
- **`src/app/admin/usage/page.tsx`** - UI –∫–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- **–ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π** —á–µ—Ä–µ–∑ –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏
- **Gzip —Å–∂–∞—Ç–∏–µ** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

## üß™ –°–ú–û–£–ö-–ü–†–û–í–ï–†–ö–ò:

```bash
# 1) –°—Ç–∞—Ç—É—Å-–∫–ª–∞—Å—Å 2xx, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É asc, gzip
curl -I -u admin:****** \
  "https://getlifeundo.com/api/admin/usage/export?days=7&statusClass=2xx&sortBy=status&sortDir=asc&gzip=1&limit=5000"
# => 200 OK, content-type: text/csv, content-encoding: gzip, filename=*.csv.gz

# 2) 4xx —Ç–æ–ª—å–∫–æ GET, endpointLike=/api/public, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è, –±–µ–∑ gzip
curl -I -u admin:****** \
  "https://getlifeundo.com/api/admin/usage/export?days=3&endpointLike=%2Fapi%2Fpublic&method=GET&statusClass=4xx&limit=20000"

# 3) –í—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤ + —è–≤–Ω—ã–π –ø–µ—Ä–∏–æ–¥
curl -s -u admin:****** \
  "https://getlifeundo.com/api/admin/usage/export?from=2025-09-01T00:00:00Z&to=2025-09-25T23:59:59Z&columns=ts,endpoint,status&sortBy=ts&sortDir=desc&limit=1000" \
  | head -n 5
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ / –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:

- **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–∫–æ–ª–æ–Ω–æ–∫** –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –∂—ë—Å—Ç–∫–∏–π –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ (SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –Ω–µ—Ç)
- **Gzip —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫** –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `stream`/`pipeline` –≤–º–µ—Å—Ç–æ `gzipSync`
- **–≠–∫—Å–ø–æ—Ä—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –±–µ–∑ PII**, —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç CSV-—Ñ–æ—Ä–º—É–ª
- **–õ–∏–º–∏—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 000**; –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–æ–±–∞–≤–∏–º ¬´cursor/ÂàÜÈ°µ¬ª ‚Äî —Å–∫–∞–∂–∏, —Å–¥–µ–ª–∞—é

## üìã –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:

### **–ù–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã CSV:**
- **–°—Ç–∞—Ç—É—Å-–∫–ª–∞—Å—Å:** `statusClass` (2xx/3xx/4xx/5xx)
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** `sortBy` (ts/status/endpoint/method) + `sortDir` (asc/desc)
- **–°–∂–∞—Ç–∏–µ:** `gzip=1` ‚Üí `.csv.gz` —Ñ–∞–π–ª —Å `content-encoding: gzip`

### **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã:**
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ:** `days`, `from`, `to`
- **Endpoint:** `endpoint` (=), `endpointLike` (ILIKE)
- **HTTP:** `method`, `status`, `statusMin`, `statusMax`
- **–õ–∏–º–∏—Ç—ã:** `limit` (–¥–æ 100,000)
- **–°—Ç–æ–ª–±—Ü—ã:** `columns` (ts,endpoint,method,status)

## üéØ –ì–û–¢–û–í–û:

**Status-Class + Sort + Gzip –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:**
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å-–∫–ª–∞—Å—Å–∞–º (2xx/3xx/4xx/5xx)
- ‚úÖ –ì–∏–±–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª—é–±–æ–º—É –ø–æ–ª—é
- ‚úÖ Gzip —Å–∂–∞—Ç–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL/CSV –∏–Ω—ä–µ–∫—Ü–∏–π
- ‚úÖ –£–¥–æ–±–Ω—ã–π UI —Å –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏

---

**–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ ¬´–∫–ª–∞—Å—Å—É –º–µ—Ç–æ–¥–∞¬ª (read/write), duration_ms –≤ CSV (–µ—Å–ª–∏ –ø–æ–ª–µ –µ—Å—Ç—å), –∏ preset-–∫–Ω–æ–ø–∫–∏ (2xx OK / 4xx Errors / 5xx Incidents)? –°–∫–∞–∂–∏: ¬´method-class + duration + presets ‚Äî –æ–¥–Ω–∏–º –ø–æ—Å—Ç–æ–º¬ª üöÄ**

