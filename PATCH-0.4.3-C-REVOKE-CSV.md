# üîß PATCH 0.4.3-C ‚Äî **Revoke API-–∫–ª—é—á–∞ + –≠–∫—Å–ø–æ—Ä—Ç Usage –≤ CSV**

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### **üîë Revoke API-–∫–ª—é—á–∞:**
- **`src/app/api/admin/keys/route.ts`** - –¥–æ–±–∞–≤–ª–µ–Ω DELETE –º–µ—Ç–æ–¥
- **`src/app/admin/keys/page.tsx`** - –∫–Ω–æ–ø–∫–∞ "Revoke (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)"
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** –ø–µ—Ä–µ–¥ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –∫–ª—é—á–∞

### **üìä –≠–∫—Å–ø–æ—Ä—Ç Usage –≤ CSV:**
- **`src/app/api/admin/usage/export/route.ts`** - —ç–∫—Å–ø–æ—Ä—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ days/from/to
- **`src/app/admin/usage/page.tsx`** - –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV (30 –¥–Ω–µ–π / 7 –¥–Ω–µ–π)
- **`src/app/admin/page.tsx`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

## üß™ –°–ú–û–£–ö-–ü–†–û–í–ï–†–ö–ò:

```bash
# 1) revoke
curl -s -u admin:****** -X DELETE https://getlifeundo.com/api/admin/keys | jq
# => { "ok": true, "revoked": true }

# 2) rotate (–ø–æ–ª—É—á–∏–º plaintext –æ–¥–∏–Ω —Ä–∞–∑)
curl -s -u admin:****** -X POST https://getlifeundo.com/api/admin/keys | jq
# => { ok:true, apiKey:"lu_‚Ä¶", last4:"abcd" }

# 3) export CSV (30 –¥–Ω–µ–π)
curl -I -u admin:****** "https://getlifeundo.com/api/admin/usage/export?days=30"
# => 200 OK, content-type: text/csv, content-disposition: attachment

# 4) export CSV (—Ç–æ—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥)
curl -I -u admin:****** "https://getlifeundo.com/api/admin/usage/export?from=2025-09-01T00:00:00Z&to=2025-09-25T23:59:59Z"
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ / –ó–ê–ú–ï–¢–ö–ò:

- **`DELETE /api/admin/keys`** –æ—Ç–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª—é—á: –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –Ω–∏–º –Ω–∞—á–Ω—É—Ç –ø–æ–ª—É—á–∞—Ç—å 401/403 (–æ–∂–∏–¥–∞–µ–º–æ)
- **–ü—Ä–∞–≤–∞:** `/api/admin/*` –∑–∞–∫—Ä—ã—Ç –≤–∞—à–∏–º BasicAuth + IP-whitelist
- **CSV —ç–∫—Å–ø–æ—Ä—Ç** ‚Äî –±–µ–∑ PII; –≤–∫–ª—é—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ `ts, endpoint, method, status`

## üìã –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:

### **API –∫–ª—é—á–∏:**
- **GET** - –ø–æ–ª—É—á–∏—Ç—å masked –∫–ª—é—á
- **POST** - —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å (plaintext –æ–¥–∏–Ω —Ä–∞–∑)
- **DELETE** - –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (revoke)

### **CSV —ç–∫—Å–ø–æ—Ä—Ç:**
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `days` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) –∏–ª–∏ `from/to` (ISO)
- **–§–æ—Ä–º–∞—Ç:** `ts,endpoint,method,status`
- **–õ–∏–º–∏—Ç:** –¥–æ 100,000 –∑–∞–ø–∏—Å–µ–π
- **–§–∞–π–ª:** `usage_{tenant}_{from}_{to}.csv`

## üéØ –ì–û–¢–û–í–û:

**Revoke + CSV –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:**
- ‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è API –∫–ª—é—á–µ–π –±–µ–∑ —Ä–æ—Ç–∞—Ü–∏–∏
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç usage –¥–∞–Ω–Ω—ã—Ö –≤ CSV
- ‚úÖ –ì–∏–±–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ (–ø–µ—Ä–∏–æ–¥/–¥–Ω–∏)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

**–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å "Revoke All" –¥–ª—è –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä—ã –≤ CSV? –°–∫–∞–∂–∏: ¬´revoke-all + filters ‚Äî –æ–¥–Ω–∏–º –ø–æ—Å—Ç–æ–º¬ª üöÄ**


