# üìä –¢–∞–±–ª–∏—Ü–∞ —Å–≤–µ—Ä–∫–∏ FreeKassa (—Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å)

## üîç –ü–æ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ª–æ–≥–∞—Ö/–∫–∞–±–∏–Ω–µ—Ç–µ

| –ü–æ–ª–µ          | –ì–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º                  | –û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                       | –°—Ç–∞—Ç—É—Å |
| ------------- | ------------------------------ | ---------------------------------------- | ------ |
| `merchant_id` | –ª–æ–≥ notify + –∫–æ–¥               | == ENV `FK_MERCHANT_ID`                  | ‚è≥     |
| `amount`      | –ª–æ–≥ create/notify + –∫–∞–±–∏–Ω–µ—Ç FK | == priceMap\[plan] (—Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞) | ‚è≥     |
| `order_id`    | –ª–æ–≥ create/notify + FK         | `LU-...` –∏–∑ create                       | ‚è≥     |
| `SIGN`        | –∫–æ–¥ notify                     | timing-safe eq (md5 –ø–æ —Å—Ö–µ–º–µ SECRET2)    | ‚è≥     |
| `intid`       | –ª–æ–≥ notify + –∫–∞–±–∏–Ω–µ—Ç FK        | —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è —Å–≤–µ—Ä–∫–∏/—Ä–µ—Ñ–∞–Ω–¥–æ–≤            | ‚è≥     |
| `email/plan`  | `us_*` –≤ —Å—Å—ã–ª–∫–µ ‚Üí –≤ notify     | —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ñ—Ä–æ–Ω—Ç–æ–º                      | ‚è≥     |

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –£—Å–ø–µ—à–Ω—ã–π notify
```bash
# Bash
./fk-notify-sim.sh https://project.vercel.app MERCHANT_ID 2490.00 LU-1234567890-abc123 SECRET2

# PowerShell
.\fk-notify-sim.ps1 https://project.vercel.app MERCHANT_ID 2490.00 LU-1234567890-abc123 SECRET2
```
**–û–∂–∏–¥–∞–µ–º–æ:** `OK` + –ª–æ–≥ `[FK][notify] OK`

### 2. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
```bash
# –¢–æ—Ç –∂–µ –≤—ã–∑–æ–≤ –µ—â—ë —Ä–∞–∑
./fk-notify-sim.sh https://project.vercel.app MERCHANT_ID 2490.00 LU-1234567890-abc123 SECRET2
```
**–û–∂–∏–¥–∞–µ–º–æ:** `OK`, –Ω–æ –ª–æ–≥ `[FK][notify] Already processed`

### 3. –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
```bash
# –° –Ω–µ–≤–µ—Ä–Ω–æ–π —Å—É–º–º–æ–π
./fk-notify-sim.sh https://project.vercel.app MERCHANT_ID 2489.99 LU-1234567890-abc123 SECRET2
```
**–û–∂–∏–¥–∞–µ–º–æ:** `400 Bad signature`

### 4. –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–æ–ª—è
```bash
# –ë–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
curl -X POST https://project.vercel.app/api/fk/notify \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "MERCHANT_ID=test"
```
**–û–∂–∏–¥–∞–µ–º–æ:** `400 Bad Request`

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã

- [ ] –í –ª–æ–≥–µ Vercel: `[FK][notify] OK` —Å `order_id`, `intid`, `amount`
- [ ] Email –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ `ab***@domain.com`
- [ ] Amount —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É–º–º–æ–π –∏–∑ create
- [ ] Order ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å create
- [ ] –í –∫–∞–±–∏–Ω–µ—Ç–µ FK: —Å—Ç–∞—Ç—É—Å "–û–ø–ª–∞—á–µ–Ω–æ" —Å —Ç–µ–º–∏ –∂–µ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –í Google Sheet/CRM (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ): —Å—Ç–∞—Ç—É—Å "Paid"

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Bad signature
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –≤ —Å—Ö–µ–º–µ –ø–æ–¥–ø–∏—Å–∏
- **–ò—Å–ø—Ä–∞–≤–∏—Ç—å:** `buildNotifySignature` –ø–æ–¥ —Å—Ö–µ–º—É –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ FK

### Missing fields
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** Content-Type –∑–∞–ø—Ä–æ—Å–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å x-www-form-urlencoded)
- **–ò—Å–ø—Ä–∞–≤–∏—Ç—å:** —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä `readBody` –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å

### Already processed
- **–ù–æ—Ä–º–∞–ª—å–Ω–æ:** –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** —á—Ç–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- **–£—Å–ø–µ—à–Ω—ã–µ notify:** `[FK][notify] OK` –≤ –ª–æ–≥–∞—Ö
- **–û—à–∏–±–∫–∏ –ø–æ–¥–ø–∏—Å–∏:** `[FK][notify] bad signature`
- **–î—É–±–ª–∏–∫–∞—Ç—ã:** `[FK][notify] Already processed`
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:** < 500ms –¥–ª—è notify endpoint
