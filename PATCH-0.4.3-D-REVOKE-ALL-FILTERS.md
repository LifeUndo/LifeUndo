# üîß PATCH 0.4.3-D ‚Äî **Revoke-All API-–∫–ª—é—á–µ–π + –§–∏–ª—å—Ç—Ä—ã CSV-—ç–∫—Å–ø–æ—Ä—Ç–∞**

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### **üö® Revoke-All API-–∫–ª—é—á–µ–π:**
- **`src/app/api/admin/keys/revoke-all/route.ts`** - POST endpoint –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
- **`src/app/admin/keys/page.tsx`** - –∫–Ω–æ–ø–∫–∞ "Revoke ALL (–∞–≤–∞—Ä–∏–π–Ω–æ)"
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤–æ–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π

### **üìä CSV-—ç–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**
- **`src/app/api/admin/usage/export/route.ts`** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç CSV-–∏–Ω—ä–µ–∫—Ü–∏–π
- **`src/app/admin/usage/page.tsx`** - UI —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏: endpoint, endpointLike, method, status, days
- **–í—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤** –∏ –≥–∏–±–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∞

## üß™ –°–ú–û–£–ö-–ü–†–û–í–ï–†–ö–ò:

```bash
# 1) Revoke-All (–∞–¥–º–∏–Ω BasicAuth)
curl -s -u admin:****** -X POST https://getlifeundo.com/api/admin/keys/revoke-all | jq
# => { ok:true, revokedAll:true, affected:n }

# 2) –°—Ä–∞–∑—É –ø–æ—Å–ª–µ ‚Äî –∫–ª–∏–µ–Ω—Ç—ã —Å –ø—Ä–µ–∂–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å 401/403

# 3) –≠–∫—Å–ø–æ—Ä—Ç CSV c —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
curl -I -u admin:****** "https://getlifeundo.com/api/admin/usage/export?days=7&endpointLike=/api/public&method=GET&statusMin=200&statusMax=399&limit=50000"
# => 200, content-type: text/csv

# 4) –í—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤
curl -s -u admin:****** "https://getlifeundo.com/api/admin/usage/export?days=1&columns=ts,endpoint,status&limit=1000" | head
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ / –ó–ê–ú–ï–¢–ö–ò:

- **Revoke-All** –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤—ã–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ ‚Üí –æ–∂–∏–¥–∞–µ–º–æ –ø–æ–ª–æ–º–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **CSV** –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç PII; –ø–æ–ª—è —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è –∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —Ñ–æ—Ä–º—É–ª—å–Ω—ã—Ö CSV-–∏–Ω—ä–µ–∫—Ü–∏–π
- –í—Å–µ –∞–¥–º–∏–Ω-—Ä—É—á–∫–∏ —É–∂–µ –∑–∞–∫—Ä—ã—Ç—ã BasicAuth + IP-whitelist
- –õ–∏–º–∏—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **100 000** —Å—Ç—Ä–æ–∫ (—Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è `limit`)

## üìã –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:

### **API –∫–ª—é—á–∏:**
- **GET** - –ø–æ–ª—É—á–∏—Ç—å masked –∫–ª—é—á
- **POST** - —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å (plaintext –æ–¥–∏–Ω —Ä–∞–∑)
- **DELETE** - –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (revoke)
- **POST /revoke-all** - –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –∫–ª—é—á–∏ (–∞–≤–∞—Ä–∏–π–Ω–æ)

### **CSV —ç–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:** `days`, `from`, `to`
- **Endpoint —Ñ–∏–ª—å—Ç—Ä—ã:** `endpoint` (=), `endpointLike` (ILIKE)
- **HTTP —Ñ–∏–ª—å—Ç—Ä—ã:** `method`, `status`, `statusMin`, `statusMax`
- **–õ–∏–º–∏—Ç—ã:** `limit` (–¥–æ 100,000)
- **–°—Ç–æ–ª–±—Ü—ã:** `columns` (ts,endpoint,method,status)
- **–ó–∞—â–∏—Ç–∞:** CSV-–∏–Ω—ä–µ–∫—Ü–∏–∏, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéØ –ì–û–¢–û–í–û:

**Revoke-All + Filters –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:**
- ‚úÖ –ê–≤–∞—Ä–∏–π–Ω–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤—Å–µ—Ö API –∫–ª—é—á–µ–π
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã CSV —ç–∫—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç CSV-–∏–Ω—ä–µ–∫—Ü–∏–π
- ‚úÖ –ì–∏–±–∫–∏–π –≤—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤
- ‚úÖ UI —Å –±—ã—Å—Ç—Ä—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

---

**–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å-–∫–ª–∞—Å—Å—É (2xx/4xx/5xx), —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ gzip-—ç–∫—Å–ø–æ—Ä—Ç? –°–∫–∞–∂–∏: ¬´status-class + sort + gzip ‚Äî –æ–¥–Ω–∏–º –ø–æ—Å—Ç–æ–º¬ª üöÄ**

