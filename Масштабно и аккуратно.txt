да, двигаем “масштабно и аккуратно”: не ломаем текущий платежный поток через FreeKassa, параллельно поднимаем новую основу (БД+админка+FAQ/статус), всё — на отдельном домене и в отдельном проекте. Ниже — короткий, чёткий план, что именно делаем и в каком порядке.

---

# Что закрепляем сейчас

**1) Прод не трогаем.**
lifeundo.ru остаётся как есть (RU/EN/Фонд + /buy → FK).

**2) Вся новая архитектура — отдельно.**
Выбираем один из доменов для “закрытого” контура: **getlifeundo.com** (или .ru). Там будут: админка, новая БД, API v2, черновые страницы. Снаружи — красивая заглушка “Скоро”.

**3) Подписки сейчас — через FK (без разовых).**
Реализуем “расчёт графиков и инвойсы” на нашей стороне: каждый период создаём заказ и присылаем ссылку FK. Это не автосписание, зато сразу работает. Когда будет готов Stripe/CP/YooKassa — просто переключим провайдера в нашем слое `Payments`, логика подписок уже будет.

---

# Что делаем по спринтам

## Спринт 0 (сегодня/завтра) — инфраструктура без влияния на прод

* [ ] Создать проект **getlifeundo** в Vercel (Preview/Production закрыты паролем).
* [ ] Подключить домен **getlifeundo.com** (или .ru), включить Password Protection.
* [ ] Поднять **PostgreSQL** (Neon/Supabase).
  ENV: `DATABASE_URL`, `JWT_SECRET`, `MAIL_*`, `FK_MERCHANT_ID`, `FK_SECRET1`, `FK_SECRET2`.
* [ ] Завести пустые таблицы (минимум): `users, plans, orders, payments, licenses, activations, subscriptions, webhooks`.
* [ ] Поставить простой **/status** и систему баннеров (читаем JSON и показываем баннер “Провайдер на техработах”).
* [ ] Сделать **FAQ** (RU/EN) и “Известные проблемы” — добавить кейсы:

  * “Ошибка подписи”;
  * “Время оплаты истекло”;
  * “Реквизиты не загрузились” (ответ FK: идут работы, повторите или выберите другой способ);
  * “Тестовый режим активирован/выключен”;
  * “Как оплатить в валюте Х”.
* [ ] Вернуть на **lifeundo.ru** финальную публичную структуру (RU/EN/Фонд + /buy) — без изменений в логике оплаты.

## Спринт 1 (неделя 1) — учёт покупок, лицензии, активации, админка v1

* [ ] FK webhook (`/api/fk/notify`) пишет в БД: `orders/payments`, выдаёт `licenses`.
* [ ] `POST /api/license/activate` (проверка ключа, лимит устройств), `GET /api/license/validate`.
* [ ] Письма: “Спасибо за оплату”, “Ключ/инструкция”, “Превышен лимит устройств”.
* [ ] **Админка v1** (getlifeundo.com/admin; пароль из ENV):

  * Dashboard: последние оплаты, ошибки webhook.
  * Users: email → заказы, лицензии.
  * Orders/Payments: статусы, фильтры, экспорт CSV.
  * Licenses: выдать вручную/заблокировать/продлить.
  * Activations: список устройств, revoke/rename.
  * Простые роли: owner (вы).
* [ ] Логи и алерты: телеграм/почта при ошибках webhook.

## Спринт 2 (неделя 2) — **подписки на FK** (инвойсы по графику)

* [ ] Модель `subscriptions` + CRON (Vercel Cron/Upstash QStash).
* [ ] Каждую дату биллинга: создаём `order(pending)` → письмо со ссылкой FK → напоминания (T-1, T+3, T+7) → статус `paid/failed`.
* [ ] Грейс-период, автопауза подписки при неплатеже, реактивация после оплаты.
* [ ] Страница “Управление подпиской” (смена тарифа/отмена → действует до конца периода).

## Спринт 3 (неделя 3+) — второй провайдер + автосписания

* [ ] Подключение **Stripe** (глобально) и/или **CloudPayments/YooKassa** (РФ).
* [ ] Единый слой `Payments` (FK/Stripe/CP), переключатель в `plans`.
* [ ] Apple Pay/Google Pay (через провайдеров).
* [ ] Расширенная аналитика, роли/аудит.

---

# Навигация и страницы

**На lifeundo.ru (паблик)**

* `/ru`, `/en`, `/fund` — контент и ссылки на оплату.
* `/ru/buy`, `/en/buy` — уже имеются, остаются, ведут в FK.
* `/faq`, `/status` — публичные помощь и статусы (без лишних деталей).

**На getlifeundo.com (закрыто)**

* `/admin` — админка (пароль).
* `/api/*` — новые v2 эндпоинты (activations, subscriptions).
* `/docs` — внутренние инструкции (процедуры, SLA, отработки ошибок).
* Заглушка для гостей (умная, с CTA подписаться на канал/новости).

---

# Админка — чек-лист функций (v1)

* Поиск по email; карточка пользователя.
* Таблицы: Orders/Payments/Licenses/Activations (фильтры, сорт, экспорт).
* Ручные операции:

  * Выдать ключ, продлить, блокировать, поменять лимит устройств.
  * Открепить устройство (revoke), переименовать.
  * Ручная отметка оплаты (на крайний случай).
* Журнал оболочек: webhook-ошибки с пэйлоадом, быстрые ретраи.
* “Аккаунты для друзей”: выдать лицензии без оплаты.
* Заготовка раздела “Запросы от госорганов/Legal” — флаги и экспорт по email.

---

# Контент/коммуникации

* **Баннер-алерт** → “Платёжный провайдер на техработах, попробуйте другой способ или повторите позже”.
* **FAQ** → перечислить все “вчерашние” кейсы + решения.
* **TG/Новости** → постим вехи: “включили подписки (инвойсы)”, “подключили второй провайдер”, “мобилка подключена к тем же лицензиям”.

---

# Что нужно от вас прямо сейчас

1. Решить домен для закрытого контура: **getlifeundo.com** или **getlifeundo.ru**.
2. Выбрать БД-провайдера: **Neon** или **Supabase** (я за Neon + Drizzle, быстро и прозрачно).
3. Подтвердить “подписки сейчас — через инвойсы FK, автосписание подключим в Спринт 3”.
4. Лимиты по устройствам для планов (например: VIP=3, Pro=5 и т.п.).
5. Почтовый провайдер: Resend/Mailgun/SMTP Beget — что берём для отправки писем?

---

# Вопрос по сайту/докам

* RU/EN/Фонд на **lifeundo.ru** вернём (как было).
* FAQ/Status добавлю туда же.
* На странице оплаты добавим *микроблок “Что делать, если реквизиты не загрузились”* с вашим полученным ответом FK.

---

как только подтвердите **домен + БД + лимиты устройств**, я:

* создам структуру проекта под getlifeundo,
* положу миграции БД и заготовки API,
* включу баннер/FAQ/статус,
* отдам вам PR/коммиты и короткие инструкции по DNS/ENV.

и да — админке сразу сделаю “ручные активации/блокировки/друзья”, чтобы вы могли работать параллельно с продажами.
