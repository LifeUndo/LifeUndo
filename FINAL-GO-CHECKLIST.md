# üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô GO-–ß–ï–ö-–õ–ò–°–¢ (10 –º–∏–Ω—É—Ç)

## ‚úÖ –ë–æ–µ–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞:
- **Timing-safe —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π** (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ç–∞–π–º–∏–Ω–≥-–∞—Ç–∞–∫)
- **CORS –∫–µ—à** –¥–ª—è Safari (600 —Å–µ–∫)
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
- **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ –ª–æ–≥–∞—Ö
- **–î–µ—Å—è—Ç–∏—á–Ω—ã–µ —Ç–æ—á–∫–∏** –¥–ª—è RUB

---

## üìã –ü–û–®–ê–ì–û–í–´–ô –ß–ï–ö-–õ–ò–°–¢:

### 1. üîê FreeKassa: –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- [ ] –í –∫–∞–±–∏–Ω–µ—Ç–µ FK —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `SECRET1`
- [ ] –í –∫–∞–±–∏–Ω–µ—Ç–µ FK —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `SECRET2` 
- [ ] –í –∫–∞–±–∏–Ω–µ—Ç–µ FK —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `API_KEY`
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 2. ‚öôÔ∏è Vercel: Environment Variables
- [ ] Project ‚Üí Settings ‚Üí Environment Variables
- [ ] `FK_MERCHANT_ID=<–Ω–æ–≤—ã–π>`
- [ ] `FK_SECRET1=<–Ω–æ–≤—ã–π>`
- [ ] `FK_SECRET2=<–Ω–æ–≤—ã–π>`
- [ ] `ALLOWED_ORIGIN=https://lifeundo.ru`
- [ ] `CURRENCY=RUB`
- [ ] **Redeploy Production**

### 3. üîó FreeKassa: Notify URL
- [ ] **Notify (POST):** `https://<project>.vercel.app/api/fk/notify`
- [ ] **Success URL:** `https://lifeundo.ru/success.html`
- [ ] **Fail URL:** `https://lifeundo.ru/fail.html`
- [ ] –ù–∞–∂–∞—Ç—å **"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å"** ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å **200**

### 4. üß™ Smoke Test
```bash
# Windows PowerShell
.\smoke-test-freekassa.ps1 https://<project>.vercel.app

# macOS/Linux
bash smoke-test-freekassa.sh https://<project>.vercel.app
```
**–û–∂–∏–¥–∞–µ–º–æ:** `create 200`, CORS –æ–∫

### 5. üì± –ñ–∏–≤–æ–π –ø–ª–∞—Ç—ë–∂ –Ω–∞ iPhone
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/pricing` –Ω–∞ iPhone
- [ ] –í–≤–µ—Å—Ç–∏ email ‚Üí "–ö—É–ø–∏—Ç—å VIP"
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ FreeKassa
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É—é –æ–ø–ª–∞—Ç—É
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/success.html`

### 6. üìä Vercel Logs
- [ ] Project ‚Üí Functions ‚Üí View Logs
- [ ] –ò—Å–∫–∞—Ç—å `[FK][notify] OK` 
- [ ] –ò—Å–∫–∞—Ç—å `200` –Ω–∞ `/api/fk/notify`
- [ ] –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Bad signature` –∏–ª–∏ `403 Forbidden`

### 7. üîÑ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- [ ] –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –µ—â—ë —Ä–∞–∑
- [ ] –û–±–Ω–æ–≤–∏—Ç—å ENV –≤ Vercel
- [ ] Redeploy

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è:

### 405 –Ω–∞ notify
- **–ü—Ä–∏—á–∏–Ω–∞:** –î–æ–º–µ–Ω –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vercel-–¥–æ–º–µ–Ω –¥–ª—è Notify URL

### 403 –Ω–∞ notify  
- **–ü—Ä–∏—á–∏–Ω–∞:** IP-—Ñ–∏–ª—å—Ç—Ä –≤–∫–ª—é—á—ë–Ω
- **–†–µ—à–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ IP FK

### Bad signature
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π/—Å—Ö–µ–º–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ ‚â† –∫–æ–¥—É
- **–†–µ—à–µ–Ω–∏–µ:** –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `buildCreateSignature`/`buildNotifySignature` –ø–æ–¥ —Å—Ö–µ–º—É –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ FK

### iOS –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç FK
- **–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `window.open` –≤–º–µ—Å—Ç–æ `location.href`
- **–†–µ—à–µ–Ω–∏–µ:** –ö–æ–¥ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `location.href`

---

## üìß –ú–∏–Ω–∏-–ø–ª–∞–Ω –≤—ã–¥–∞—á–∏ –ª–∏—Ü–µ–Ω–∑–∏–π (–ø–æ—Å–ª–µ `notify OK`):

### MVP –ø–æ–¥—Ö–æ–¥:
- [ ] Google Sheet ¬´orders¬ª (order_id, email, plan, amount, paid_at)
- [ ] –°–∫—Ä–∏–ø—Ç (cloud fn/cron) –∏—â–µ—Ç `paid:true` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ —Å –∫–ª—é—á–æ–º
- [ ] –ù–∞ `/success.html` ‚Äî —Ç–µ–∫—Å—Ç ¬´–µ—Å–ª–∏ –ø–∏—Å—å–º–∞ –Ω–µ—Ç ‚Üí –ø–æ–¥–¥–µ—Ä–∂–∫–∞¬ª

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω –ø–æ–¥—Ö–æ–¥:
- [ ] Vercel KV –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] SendGrid/SMTP –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª—é—á–µ–π
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π

---

## üéØ –ì–û–¢–û–í–û –ö –ë–û–Æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤:
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ñ–∏–≤–∞—è –æ–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iPhone  
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ –ë–æ–µ–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∞

**üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–∏–≤—É—é –æ–ø–ª–∞—Ç—É –Ω–∞ iPhone –∏ –ø–æ–ª—É—á–∏—Ç—å `[FK][notify] OK` –≤ –ª–æ–≥–∞—Ö!
