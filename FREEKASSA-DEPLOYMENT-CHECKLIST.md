# üöÄ FreeKassa Deployment Checklist

## üö® –ö–†–ò–¢–ò–ß–ù–û: –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

**–°–†–û–ß–ù–û** - —Å–µ–∫—Ä–µ—Ç—ã FreeKassa –±—ã–ª–∏ –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –∫–æ–¥–µ!

### 1. –†–æ—Ç–∞—Ü–∏—è –≤ –∫–∞–±–∏–Ω–µ—Ç–µ FreeKassa
- [ ] –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `FK_SECRET1`
- [ ] –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `FK_SECRET2` 
- [ ] –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `API_KEY`
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Vercel ENV
- [ ] Project ‚Üí Settings ‚Üí Environment Variables
- [ ] `FK_MERCHANT_ID=<–Ω–æ–≤—ã–π>`
- [ ] `FK_SECRET1=<–Ω–æ–≤—ã–π>`
- [ ] `FK_SECRET2=<–Ω–æ–≤—ã–π>`
- [ ] `ALLOWED_ORIGIN=https://lifeundo.ru`
- [ ] `CURRENCY=RUB` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3. Redeploy
- [ ] Redeploy Production –≤ Vercel
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏: `https://<project>.vercel.app/_vercel/functions`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ FreeKassa

### URLs (–í–ê–ñ–ù–û: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Vercel-–¥–æ–º–µ–Ω –¥–ª—è Notify!)
- [ ] **Notify URL:** `https://<project>.vercel.app/api/fk/notify`
- [ ] **Success URL:** `https://lifeundo.ru/success.html`
- [ ] **Fail URL:** `https://lifeundo.ru/fail.html`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- [ ] –ù–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å" –≤ –∫–∞–±–∏–Ω–µ—Ç–µ FK
- [ ] –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å **200 OK**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Smoke Test
```bash
# Linux/Mac
./smoke-test-freekassa.sh https://<project>.vercel.app

# Windows PowerShell
.\smoke-test-freekassa.ps1 https://<project>.vercel.app
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç create
curl -X POST https://<project>.vercel.app/api/fk/create \
  -H "Content-Type: application/json" \
  -H "Origin: https://lifeundo.ru" \
  -d '{"email":"test@example.com","plan":"vip_lifetime","locale":"ru"}'

# –û–∂–∏–¥–∞–µ–º–æ: {"url":"https://pay.freekassa.ru/...","order_id":"LU-..."}
```

### –ñ–∏–≤–∞—è –æ–ø–ª–∞—Ç–∞
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/pricing` –Ω–∞ iPhone
- [ ] –í–≤–µ—Å—Ç–∏ email ‚Üí "–ö—É–ø–∏—Ç—å VIP"
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ FreeKassa
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É—é –æ–ø–ª–∞—Ç—É
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/success.html`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ Vercel
- [ ] Project ‚Üí Functions ‚Üí View Logs
- [ ] –ò—Å–∫–∞—Ç—å `[FK][create]` - —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–∏—è
- [ ] –ò—Å–∫–∞—Ç—å `[FK][notify] OK` - —É—Å–ø–µ—à–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Bad signature` –∏–ª–∏ `403 Forbidden`

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

### 405 Not Allowed
- **–ü—Ä–∏—á–∏–Ω–∞:** Notify URL —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vercel-–¥–æ–º–µ–Ω –¥–ª—è Notify URL

### Bad signature
- **–ü—Ä–∏—á–∏–Ω–∞:** –§–æ—Ä–º—É–ª–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–∞–±–∏–Ω–µ—Ç–æ–º FK
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –≤ `buildCreateSignature`/`buildNotifySignature`

### iOS –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É
- **–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `window.open` –≤–º–µ—Å—Ç–æ `location.href`
- **–†–µ—à–µ–Ω–∏–µ:** –ö–æ–¥ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `location.href`

### CORS –æ—à–∏–±–∫–∏
- **–ü—Ä–∏—á–∏–Ω–∞:** `ALLOWED_ORIGIN` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- **–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ALLOWED_ORIGIN=https://lifeundo.ru`

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤:
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ñ–∏–≤–∞—è –æ–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iPhone
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –°–µ–∫—Ä–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –∑–∞—â–∏—â–µ–Ω—ã

---

**üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–≤–µ—Å—Ç–∏ –∂–∏–≤—É—é –æ–ø–ª–∞—Ç—É –Ω–∞ iPhone –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!
